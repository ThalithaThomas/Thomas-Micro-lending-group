(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{485:function(e,t,n){"use strict";n.r(t),n.d(t,"searchByImageInitialize",(function(){return A}));n(9),n(64),n(13),n(3),n(710),n(718),n(720),n(721),n(723),n(726),n(727),n(728),n(729),n(730),n(731),n(732),n(733),n(735),n(736),n(737),n(738),n(739),n(740),n(741),n(742),n(743),n(744),n(18),n(15),n(248),n(176),n(5);var r,a=n(0),i=function(){var e=Object(a.d)('[data-search="image"]');e.length>0&&e.forEach((function(e){return function(e){var t=BASE64_SEARCH_BY_IMAGE;if(t&&t.split(",").length>0){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),a=0;a<n.length;a++)r[a]=n.charCodeAt(a);var i=URL.createObjectURL(new Blob([r],{type:"image/png"}));e.style.backgroundImage="url("+i+")"}}(e)}))},c=n(83),s=n(2),o=n(1),u=n.n(o),d=n(287),f=n(642),l=(n(17),n(342)),h=(n(70),n(76),n(652)),v=n(666),p=n(667),b=n(668),g=function(e){var t=window.URL.createObjectURL(e),n=Object(a.c)("#"+d.o);n&&t&&(n.style.backgroundImage="url("+t+")")},m=n(669),j=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.l.includes(t.type)){e.next=2;break}throw new h.a("Invalid file type",t.type);case 2:if(!(t.size>d.g)){e.next=4;break}throw new h.a("Invalid file size");case 4:return e.prev=4,g(t),e.next=8,Object(p.a)(t);case 8:if(!((n=e.sent).width<d.j||n.height<d.j)){e.next=11;break}throw new h.a("Invalid file min dimensions");case 11:return r=Object(m.a)(n),e.next=14,Object(v.a)(n,r);case 14:a=e.sent,Object(b.b)(a,t.type),e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(4),console.error("Error trying to process the file:",e.t0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t){return e.apply(this,arguments)}}(),w=n(7),O=n(4),I=function(e){var t=Object(w.getRandomRange)(0,d.t.length-1);e.textContent=Object(O.a)(d.t[t])},E=function(){var e=document.getElementById(d.u);e&&(Object(a.c)("#"+d.n).classList.add("is-uploading"),I(e),r=setInterval((function(){return I(e)}),d.s))},y=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&clearInterval(r),Object(h.c)(),t){e.next=5;break}throw new h.a("Invalid file type","no_file");case 5:return E(),e.next=8,j(t);case 8:(n=Object(a.c)("#"+d.f))&&(n.value=""),l.a.goToSearchByImage(),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(0),Object(h.d)(e.t0),i={type:e.t0.message?h.b[e.t0.message].event:"unknown"},e.t0.fileExtension&&(i.file_extension=e.t0.fileExtension),Object(f.a)("searchImageError",i);case 19:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),L=function(e){e.preventDefault(),e.stopPropagation()};function x(e){L(e),this.classList.contains("is-uploading")||this.classList.add("is-dragover")}function k(e){L(e),this.classList.remove("is-dragover")}function T(e){return _.apply(this,arguments)}function _(){return(_=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(t),!this.classList.contains("is-uploading")){e.next=3;break}return e.abrupt("return");case 3:this.classList.remove("is-dragover"),n=t.dataTransfer&&t.dataTransfer.files[0],Object(f.a)("searchImageSelection",{type:"drop"}),y(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var R=function(e){var t=Object(a.c)("form",e);if(t){var n,r=Object(a.c)("#"+d.f,t);null==r||r.addEventListener("change",(function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];y(n),Object(f.a)("searchImageSelection",{type:"select"})})),("draggable"in(n=document.createElement("div"))||"ondragstart"in n&&"ondrop"in n)&&"FileReader"in window&&(t.classList.add("is-dragndrop-enabled"),t.addEventListener("dragover",x),t.addEventListener("dragleave",k),t.addEventListener("drop",T)),t.addEventListener("click",(function(){return null==r?void 0:r.click()}))}},M=function(){var e=Object(s.a)(u.a.mark((function e(){var t,r,i,s,o,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(a.c)("#"+d.p)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.e(88).then(n.t.bind(null,875,7));case 4:t=e.sent,r=t.default,i=Object(c.a)(),s=i.format,o=i.base64,(f=a.e.ModalInstance.print({name:"search-by-image",html:r({CSRF_TOKEN:CSRF_TOKEN,URL_STATIC_IMG:URL_STATIC_IMG,FILE_MIN_WIDTH_HEIGHT:d.j,FILE_MAX_SIZE_WITH_UNITS:d.h,TEXT_VALID_TYPES:d.q.join(", "),base64:o,format:s})},!1))&&(R(f),f.addEventListener("hide",h.c));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(),e.next=3,n.e(42).then(n.bind(null,874));case 3:t=e.sent,(0,t.searchByImageShowModal)(),Object(f.a)("searchImageModal");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function U(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer&&"Files"===e.dataTransfer.types[0]&&S()}var A=function(){var e;(e=Object(a.d)('[data-modal="'+d.r+'"]')).length>0&&e.forEach((function(e){e.addEventListener("click",Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(f.a)("searchImage"),S();case 2:case"end":return e.stop()}}),e)}))))})),window.addEventListener("dragenter",U),Object(c.b)()&&(M(),i())}},642:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(22);var r=n(29),a=function(e,t){Object(r.a)({description:e,options:Object.assign({},t||{})})}},652:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return l}));var r=n(38),a=n(678),i=n(0),c=n(4),s=n(287),o=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).message=t,r.fileExtension=n,r}return Object(r.a)(t,e),t}(Object(a.a)(Error)),u={"Invalid file min dimensions":{message:Object(c.a)(s.b,s.j,s.j),event:"dimension"},"Invalid file size":{message:Object(c.a)(s.c,s.h),event:"size"},"Invalid file type":{message:Object(c.a)(s.e,s.q[0],s.q[1]),event:"format"},Error:{message:Object(c.a)(s.d),event:"unknown"}},d=function(){var e=Object(i.c)("#"+s.p);return{form:Object(i.c)("#"+s.n),errorElement:Object(i.c)(".form-alert",e)}},f=function(){var e=d().errorElement;e&&e.classList.add("hide")},l=function(e){var t,n=d(),r=n.errorElement,a=n.form;if(r){var c=Object(i.c)("span",r);if(c){var o=(null===(t=u[e.message])||void 0===t?void 0:t.message)||u.Error.message;c.textContent=o,r.classList.remove("hide"),a.classList.remove("is-uploading"),Object(i.c)("#"+s.a).value=""}}}},666:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(2),a=n(1),i=n.n(a),c=(n(13),n(3),n(17),n(18),n(15),function(){var e=Object(r.a)(i.a.mark((function e(t,r){var a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(145).then(n.t.bind(null,694,7));case 2:return a=e.sent,c=a.default,e.next=6,c().resize(t,r,{unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2});case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},667:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(3),n(17),n(13),n(18),n(15),n(248),n(176);var r=function(e){return new Promise((function(t,n){var r=new Image;r.src=URL.createObjectURL(e),r.onload=function(){t(r)},r.onerror=n}))}},668:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d}));var r=n(2),a=n(1),i=n.n(a),c=(n(9),n(46),n(0)),s=n(287),o=n(438),u=function(){var e=Object(r.a)(i.a.mark((function e(t,n){var r,a,u,d,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.toDataURL(n,s.k),a=Object(c.c)("#"+s.a),u=Object(c.c)("#"+s.m),d=r.replace("data:"+n+";base64,",""),a.value=d,u.value=n,f={imageFile:{imageBase64:d,imageType:n},searchType:"upload"},localStorage.setItem(o.b,JSON.stringify(f));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),d=function(e,t){return e.toDataURL(t,s.k).replace("data:"+t+";base64,","")}},669:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(287),a=function(e){var t=document.createElement("canvas"),n=r.j,a=r.j;if(e.width!==e.height){var i=Math.min(e.width,e.height)/r.j;n=Math.round(e.width/i),a=Math.round(e.height/i),e.width>e.height?(n=Math.min(n,r.i),a=Math.round(n*(e.height/e.width))):(a=Math.min(a,r.i),n=Math.round(a*(e.width/e.height)))}return t.width=n,t.height=a,t}}}]);
//# sourceMappingURL=37.78d044e6666b988566d564a5d9619798.js.map